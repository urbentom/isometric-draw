<html>
    <head>
        <title>Playground!</title>
    </head>
    <body>
        <canvas id="grid" width="500" height="500"></canvas>


    </body>
    <style>
        #grid{
            background-color: thistle;
        }
    </style>
    <script>

        function app (){
            console.log('App!')
            var canvas=document.getElementById("grid");

            console.log('canvas', canvas)

            var ctx=canvas.getContext("2d");
            var cw=canvas.width;
            var ch=canvas.height;

            var offsetX,offsetY;

            function reOffset(){
                var BB=canvas.getBoundingClientRect();
                offsetX=BB.left;
                offsetY=BB.top;        
            }
            reOffset();

            const gridSize = 20;
            const halfGridSize = gridSize / 2;
            

            ctx.fillStyle='purple';
            ctx.strokeStyle="black";
            ctx.lineWidth=1;

            var shapes = []


            // Generate all grid
            for(var x = 0; x < cw; x += gridSize){
                const xEven = ((x / gridSize)%2 === 0)? true : false;
                const xPlus = x + gridSize
            
                for(var y = 0; y < ch; y += halfGridSize){

                    const yEven = ((y / halfGridSize)%2 === 0)? true : false;
                    const yPlus = y + gridSize

                    console.log("xEven | yEven", xEven, yEven)

                    if(yEven && xEven || !yEven && !xEven){
                        shapes.push([{x, y: y + halfGridSize}, {x: xPlus, y: yPlus}, {x:xPlus, y}])
                    }
                    else if(!yEven && xEven || yEven && !xEven){
                        shapes.push([{x: x, y: yPlus}, {x:x + gridSize, y: y + halfGridSize}, {x: x, y}])
                    }
                    else {
                        // You done fucked up
                    }

                }
            }


            for(var i=0;i<shapes.length;i++){
                defineShape(shapes[i]);
                ctx.stroke();
            }

            function defineShape(s){
                ctx.beginPath();
                ctx.moveTo(s[0].x,s[0].y);
                for(var i=1;i<s.length;i++){
                    ctx.lineTo(s[i].x,s[i].y);
                }
                ctx.closePath();
            }

            function handleMouseMove(e){
                console.log('Move!')

                e.preventDefault();
                e.stopPropagation();

                mouseX=parseInt(e.clientX-offsetX);
                mouseY=parseInt(e.clientY-offsetY);

                ctx.clearRect(0,0,cw,ch);
                for(var i=0;i<shapes.length;i++){
                    defineShape(shapes[i]);
                    if(ctx.isPointInPath(mouseX,mouseY)){
                        ctx.fill();             
                    }
                }
            }

            // function handleMouseClick(e){
            //     console.log('Click!')

            //     e.preventDefault();
            //     e.stopPropagation();
            //     // mouse position
            //     mouseX=parseInt(e.clientX-offsetX);
            //     mouseY=parseInt(e.clientY-offsetY);

            //     ctx.clearRect(0,0,cw,ch);
            //     for(var i=0;i<shapes.length;i++){
            //         defineShape(shapes[i]);
            //         if(ctx.isPointInPath(mouseX,mouseY)){
            //             ctx.globalAlpha = 1.00;
            //             ctx.fill();
            //         }                  
            //     }
            // }

            canvas.addEventListener('mousemove', handleMouseMove)
            canvas.addEventListener('click', handleMouseClick)


        }


        (function(){
            console.log('Start')
            document.addEventListener("DOMContentLoaded", app);
        })();


    </script>
</html>